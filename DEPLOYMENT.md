# Nong-View Render.com 배포 가이드

## 🚀 Render.com 배포 설정

### 1. 사전 준비

#### 필요 사항
- GitHub 계정 및 Nong-View 리포지토리
- Render.com 계정 (무료 플랜 사용 가능)

### 2. Render.com 웹 서비스 생성

#### 2.1 새 웹 서비스 생성
1. [Render.com](https://render.com) 대시보드에 로그인
2. "New +" 버튼 클릭 → "Web Service" 선택
3. GitHub 연결 및 `aebonlee/Nong-View` 리포지토리 선택

#### 2.2 기본 설정
```yaml
Name: nong-view-api
Environment: Python
Region: Oregon (US West)
Branch: main
Build Command: chmod +x build.sh && ./build.sh
Start Command: chmod +x start.sh && ./start.sh
```

#### 2.3 고급 설정

**Instance Type:**
- Free Tier: 512MB RAM, 0.1 CPU (무료)
- Starter: $7/월 (권장)

**Environment Variables:**
```bash
# 필수 환경 변수
PYTHON_VERSION=3.10.12
GDAL_CONFIG=/usr/bin/gdal-config
GDAL_DATA=/usr/share/gdal
PROJ_LIB=/usr/share/proj

# 애플리케이션 설정
ENVIRONMENT=production
API_V1_STR=/api/v1
PROJECT_NAME=Nong-View API

# 보안 (Auto-generate 버튼 사용)
SECRET_KEY=<auto-generated>

# CORS 설정
CORS_ORIGINS=https://nong-view.onrender.com,https://your-frontend-domain.com

# 파일 경로
UPLOAD_PATH=/tmp/uploads
CROP_PATH=/tmp/crops
EXPORT_PATH=/tmp/exports
```

### 3. 데이터베이스 설정 (선택사항)

#### 3.1 PostgreSQL 데이터베이스 생성
1. Render.com 대시보드에서 "New +" → "PostgreSQL" 선택
2. 설정:
   ```yaml
   Name: nong-view-db
   Database Name: nongview
   User: nongview_user
   Region: Oregon (US West)
   Plan: Free (1GB 저장소)
   ```

#### 3.2 PostGIS 확장 설치
데이터베이스 생성 후 연결하여 실행:
```sql
CREATE EXTENSION IF NOT EXISTS postgis;
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
```

#### 3.3 웹 서비스에 데이터베이스 연결
웹 서비스 환경 변수에 추가:
```bash
DATABASE_URL=<PostgreSQL 연결 문자열>
```

### 4. Redis 설정 (선택사항)

#### 4.1 Redis 인스턴스 생성
1. "New +" → "Redis" 선택
2. 설정:
   ```yaml
   Name: nong-view-redis
   Plan: Free (25MB)
   Region: Oregon (US West)
   ```

#### 4.2 웹 서비스에 Redis 연결
환경 변수에 추가:
```bash
REDIS_URL=<Redis 연결 문자열>
```

### 5. 배포 실행

#### 5.1 자동 배포
- GitHub에 푸시하면 자동으로 배포 시작
- 빌드 로그에서 진행 상황 확인

#### 5.2 수동 배포
- Render.com 대시보드에서 "Manual Deploy" 버튼 클릭

### 6. 배포 확인

#### 6.1 서비스 상태 확인
배포 완료 후 다음 URL들을 확인:

- **API 서버**: `https://nong-view.onrender.com/`
- **헬스 체크**: `https://nong-view.onrender.com/health`
- **API 문서**: `https://nong-view.onrender.com/api/docs`

#### 6.2 예상 응답
```json
{
  "message": "Nong-View API Server",
  "version": "1.0.0",
  "status": "running",
  "docs": "/api/docs"
}
```

### 7. 트러블슈팅

#### 7.1 일반적인 오류

**빌드 실패 (GDAL 관련)**
```bash
# build.sh에서 GDAL 설치 확인
apt-get install -y gdal-bin libgdal-dev
```

**메모리 부족**
- Free tier는 512MB 제한
- Starter 플랜($7/월)으로 업그레이드 권장

**시작 실패**
```bash
# start.sh 실행 권한 확인
chmod +x start.sh
```

#### 7.2 로그 확인
- Render.com 대시보드 → 서비스 → "Logs" 탭
- 실시간 로그 모니터링 가능

### 8. 성능 최적화

#### 8.1 권장 설정
```yaml
# 프로덕션 환경
Instance Type: Starter ($7/월)
Environment Variables:
  - DEBUG=False
  - LOG_LEVEL=INFO
  - WORKERS=1  # 메모리 제한으로 인해
```

#### 8.2 모니터링
- Render.com 기본 메트릭 활용
- 응답 시간 및 에러율 모니터링

### 9. 업데이트 배포

#### 9.1 자동 배포
1. GitHub에 변경사항 푸시
2. Render.com이 자동으로 새 배포 시작
3. 배포 완료까지 대기

#### 9.2 롤백
- Render.com 대시보드에서 이전 배포로 롤백 가능

### 10. 비용 관리

#### 10.1 무료 플랜 제한
- **웹 서비스**: 월 750시간 (31일 기준 24시간 운영 가능)
- **PostgreSQL**: 1GB 저장소
- **Redis**: 25MB
- **대역폭**: 100GB/월

#### 10.2 유료 플랜 권장사항
프로덕션 사용 시 권장:
- **Starter 플랜**: $7/월 (더 많은 메모리와 CPU)
- **PostgreSQL**: $7/월 (더 많은 저장소와 연결)

### 11. 보안 설정

#### 11.1 환경 변수 보안
- SECRET_KEY는 반드시 랜덤 생성
- 데이터베이스 크리덴셜 보호
- API 키들은 환경 변수로 관리

#### 11.2 HTTPS
- Render.com에서 자동으로 HTTPS 제공
- 커스텀 도메인 연결 가능

## 🔧 추가 설정

### Custom Domain 연결 (선택사항)
1. 도메인 설정에서 커스텀 도메인 추가
2. DNS 설정에서 CNAME 레코드 추가
3. SSL 인증서 자동 발급

### 환경별 배포
- 개발: `main` 브랜치
- 스테이징: `staging` 브랜치  
- 프로덕션: `production` 브랜치

각 환경별로 별도 Render.com 서비스 생성 권장

---

## 📞 지원

문제 발생 시:
1. Render.com 문서 확인: https://render.com/docs
2. GitHub 이슈 등록
3. Render.com 커뮤니티 포럼 활용

---

*최종 업데이트: 2025-10-26*
*작성자: Claude Sonnet*